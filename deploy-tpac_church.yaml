apiVersion: 2021-10-01
location: eastasia
name: tpacChurchAppGroup
properties:
  containers:
  - name: reverse-proxy
    properties:
      image: caddy:2.6
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 443
      resources:
        requests:
          memoryInGB: 1.0
          cpu: 1.0
        limits:
          memoryInGB: 1.0
          cpu: 1.0
      volumeMounts:
        - name: proxy-caddyfile
          mountPath: /etc/caddy
        - name: proxy-data
          mountPath: /data
        - name: proxy-config
          mountPath: /config
  - name: tpac-churchapp-api
    properties:
      image: tpacacr.azurecr.io/tpac_api:latest
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
      ports:
      - port: 8001
  - name: tpac-churchapp-admin
    properties:
      image: tpacacr.azurecr.io/tpac_admin:latest
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
      ports:
      - port: 8080
  - name: tpac-churchapp-db
    properties:
      image: tpacacr.azurecr.io/tpac_db:latest
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
      ports:
      - port: 3306
      environmentVariables:
        - name: MYSQL_ROOT_PASSWORD
          value: rootpassword
      volumeMounts:
      - mountPath: /var/lib/mysql
        name: fileshare
  osType: Linux
  ipAddress:
    type: Public
    ports:
    - protocol: tcp
      port: 80
    - protocol: tcp
      port: 443 
    dnsNameLabel: tpacchurchapp
  volumes:
  - name: fileshare
    azureFile:
      sharename: tpacchurchdbfile
      storageAccountName: tpacstorageaccount
      storageAccountKey: <MASKED>
  - name: proxy-caddyfile
    azureFile: 
      shareName: proxy-caddyfile
      storageAccountName: tpacstorageaccount
      storageAccountKey: <MASKED>
  - name: proxy-data
    azureFile: 
      shareName: proxy-data
      storageAccountName: tpacstorageaccount
      storageAccountKey: <MASKED>
  - name: proxy-config
    azureFile: 
      shareName: proxy-config
      storageAccountName: tpacstorageaccount
      storageAccountKey: <MASKED>
  imageRegistryCredentials:
  - server: tpacacr.azurecr.io
    username: <MASKED>
    password: <MASKED>
tags: {tpacchurch: churchapp}
type: Microsoft.ContainerInstance/containerGroups
